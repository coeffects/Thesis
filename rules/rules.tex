\documentclass[
		twoside,openright,notitlepage,numbers=noenddot,headinclude,%1headlines,
                footinclude=true,cleardoublepage=empty,
                BCOR=10mm,paper=a4,fontsize=10pt, % Binding correction, paper type and font size
                ngerman,american, % Languages
                ]{scrreprt} 
\input{../classicthesis-config}

\usepackage{catchfilebetweentags }
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{breakurl}
\usepackage{stmaryrd}
\usepackage{multicol}
\usepackage{semantic}
\usepackage{paralist}
\usepackage{etoolbox} 
\usepackage{graphicx}
\usepackage{color}

% ==================================================================================================
% COMMAND DEFINITIONS
% ==================================================================================================

%<*rule-definitions>

% Calculus names, inference rules and rule names
\newcommand{\fcl}{$\lambda_{\textnormal{\sffamily fc}}$}
\newcommand{\scl}{$\lambda_{\textnormal{\sffamily sc}}$}
\newcommand{\cml}{$\lambda_{\textnormal{\sffamily cm}}$}

\newcommand{\namefcl}[1]{ \textnormal{\footnotesize{(\emph{#1})}\;\;} }
\newcommand{\namescl}[1]{ \textnormal{\footnotesize{(\emph{#1})}\;\;} }
\newcommand{\namecml}[1]{ \textnormal{\footnotesize{(\emph{#1})}\;\;} }

\newcommand{\rulefcl}[3]{ \inference[(\emph{#1})\;]{ #2 }{ #3 } }
\newcommand{\rulescl}[3]{ \inference[(\emph{#1})\;]{ #2 }{ #3 } }
\newcommand{\rulecml}[3]{ \inference[(\emph{#1})\;]{ #2 }{ #3 } }

\newcommand{\ctxtrans}[2]{#1 \Rightarrow_c #2}  % Context transformation rules in \scl

% Formatting for source code & types
\definecolor{cmtclr}{rgb}{0.0,0.6,0.0}
\definecolor{kvdclr}{rgb}{0.0,0.0,0.6}
\definecolor{strclr}{rgb}{0.5,0.1,0.0}
\definecolor{prepclr}{rgb}{0.0,0.0,0.0}

\newcommand{\sep}[0]{\; | \;}
\newcommand{\kvd}[1]{\textnormal{\textcolor{kvdclr}{\bfseries\sffamily #1}}}
\newcommand{\str}[1]{\textnormal{\textcolor{strclr}{\ttfamily "#1"}}}
\newcommand{\prepk}[1]{\textnormal{\textcolor{prepclr}{\bfseries\sffamily #1}}}
\newcommand{\prepi}[1]{\textnormal{\textcolor{prepclr}{\ttfamily #1}}}
\newcommand{\ident}[1]{\textnormal{\sffamily #1}}
\newcommand{\cmt}[1]{\textit{\sffamily\textcolor{cmtclr}{#1}}}

\newcommand{\ctyp}[2]{C^{#1}#2}
\newcommand{\mtyp}[2]{M^{#1}#2}
\newcommand{\subst}[3]{#1[#2 \leftarrow #3]}

% Flat coeffect operations - (e, (+), \/, /\)
\newcommand{\funit}{\mathsf{e}}
\newcommand{\fseq}{\oplus}
\newcommand{\fmin}{\wedge}
\newcommand{\fmax}{\vee}

% Structural coeffect operations - (e, (+), x, 1, +, 0)
\newcommand{\sunit}{\mathsf{e}}  % used variable
\newcommand{\sone}{1}            % constant
\newcommand{\szero}{0}           % unused variable
\newcommand{\sprd}[0]{ \times }
\newcommand{\sseq}[0]{ \oplus }
\newcommand{\smax}[0]{ + }

% Coeffect metalanguage operations - (e, (+))
\newcommand{\munit}{\mathsf{e}}
\newcommand{\mseq}[0]{ \oplus }

%</rule-definitions>



% comonadic semantics
% \newcommand{\cosem}[1]{\llbracket #1 \rrbracket}
% \newcommand{\ccat}[0]{\mathcal{C}}
% \newcommand{\obj}[1]{\textnormal{obj}(#1)}
% \newcommand{\cobind}[2]{#1^\dagger_{#2}}

% \newcommand{\cmerge}[0]{ \ident{m} } %{ \reflectbox{\rotatebox[origin=c]{180}{$\Delta$}} }
% \newcommand{\csplit}[0]{ \ident{s} }
% \newcommand{\cdupl}[0]{ \Delta } %{ \Upsilon }

% \newcommand{\idf}[0]{ \ident{id} }
% \newcommand{\ctimes}{ \hat{\times} }



% ==================================================================================================

\title{Typing rules}
\begin{document}
\maketitle

% ==================================================================================================
% FLAT COEFFECT LANGUAGE
% ==================================================================================================

\begin{figure}
\begin{equation*}
\rulefcl{var}
  {x : \alpha \in \Gamma}
  {\ctyp{\funit}{\Gamma} \vdash x : \alpha }
\end{equation*}
\begin{equation*}
\rulefcl{app}
  {\ctyp{r}{\Gamma} \vdash e_1 : \ctyp{s}{\alpha} \rightarrow \beta &
   \ctyp{t}{\Gamma} \vdash e_2 : \alpha }
  {\ctyp{r \fmax (s \fseq t)}{\Gamma} \vdash e_1~e_2 : \beta}
\end{equation*}
\begin{equation*}
\rulefcl{sub}
  {\ctyp{s}{\Gamma} \vdash e : \alpha }
  {\ctyp{r}{\Gamma} \vdash e : \alpha }
\;(s\leq r)  
\end{equation*}
\begin{equation*}
\rulefcl{abs}
  {\ctyp{r \fmin s}{(\Gamma, x:\alpha)} \vdash e : \beta}
  {\ctyp{r}{\Gamma} \vdash \lambda x.e : \ctyp{s}{\alpha} \rightarrow \beta }
\end{equation*}

\caption{Type system for the flat coeffect language \fcl}
\label{fig:fcl-types}
\end{figure}

% ==================================================================================================
% STRUCTURAL COEFFECT LANGUAGE
% ==================================================================================================

%<*scl-types>
\begin{figure}

\paragraph{Typing rules\quad $\ctyp{r}{\Gamma} \vdash e : \alpha $}~

\begin{equation*}
\rulescl{var}
  {}
  {\ctyp{\sunit}{(v:\alpha)} \vdash v : \alpha }
\end{equation*}
\begin{equation*}
\rulescl{const}
  {c : \alpha \in \Phi}
  {\ctyp{\sone}{()} \vdash c : \alpha}
\end{equation*}
\begin{equation*}
\rulescl{fun}
  {\ctyp{r \sprd s}{(\Gamma, v:\alpha)} \vdash e : \beta & v \notin \Gamma}
  {\ctyp{r}{\Gamma} \vdash \lambda v.e : \ctyp{s}{\alpha} \rightarrow \beta }
\end{equation*}
\begin{equation*}
\rulescl{app}
  {\ctyp{s}{\Gamma_1} \vdash e_1 : \ctyp{r}{\alpha} \rightarrow \beta &
   \ctyp{t}{\Gamma_2} \vdash e_2 : \alpha }
  {\ctyp{s \sprd (r \sseq t)}{(\Gamma_1, \Gamma_2)} \vdash e_1~e_2 : \beta}
\end{equation*}
\begin{equation*}
\rulescl{let}
  {\ctyp{r \sprd s}{(\Gamma_1, v:\alpha)} \vdash e_1 : \beta &
  \ctyp{t}{\Gamma_2} \vdash e_2 : \alpha}
  {\ctyp{r \sprd (s \sseq t)}{(\Gamma_1, \Gamma_2)} \vdash \kvd{let}~x=e_2~\kvd{in}~e_1 : \beta}
\end{equation*}
\begin{equation*}
\rulescl{ctx}
  {\ctyp{r}{\Gamma} \vdash e : \alpha &
   \ctxtrans{\ctyp{r'}{\Gamma'}}{\ctyp{r}{\Gamma}}}
  {\ctyp{r'}{\Gamma'} \vdash e : \alpha}
\end{equation*}

\vspace{2em}
\paragraph{Context rules\quad $\ctxtrans{\ctyp{r}{\Gamma}}{\ctyp{r}{\Gamma}} $}~

\begin{equation*}
\rulescl{nest}
  {  \ctxtrans{\ctyp{r'}{\Gamma_1'}}{\ctyp{r}{\Gamma_1}} }
  {  \ctxtrans{\ctyp{r'\sprd s}{(\Gamma_1', \Gamma_2)}}{\ctyp{r\sprd s}{(\Gamma_1, \Gamma_2)}} }
\end{equation*}
\begin{equation*}
\namescl{nest}
  \ctxtrans{\ctyp{r\sprd s}{(\Gamma_1, \Gamma_2)}}{\ctyp{s\sprd r}{(\Gamma_2, \Gamma_1)}}
\end{equation*}
\begin{equation*}
\namescl{empty}
  \ctxtrans{ \ctyp{r \sprd \sone}{(\Gamma, ())} }{
    \ctyp{r}{\Gamma}}
\end{equation*}
\begin{equation*}
\namescl{weak}
  \ctxtrans{\ctyp{r\sprd \szero}{(\Gamma, x:\alpha)} }{ \ctyp{r}{\Gamma}}
\end{equation*}
\begin{equation*}
\namescl{contr}~
  \ctxtrans{\ctyp{r \smax s}{(x:\alpha)} }{
    \ctyp{r \sprd s}{(x:\alpha, x:\alpha)}}
\end{equation*}
\begin{equation*}
\namescl{assoc}~
  \ctxtrans{\ctyp{r\sprd (s\sprd t)}{(\Gamma_1, (\Gamma_2, \Gamma_3))} }{
    \ctyp{(r\sprd s)\sprd t}{((\Gamma_1, \Gamma_2), \Gamma_3)}}\;
\end{equation*}
\begin{equation*}
\namescl{sub}~
  \ctxtrans{\ctyp{r}{\Gamma}}{\ctyp{s}{\Gamma}}
    \quad(\textnormal{when}~s \leq r)
\end{equation*}

\vspace{3em}
\caption{Type system for the structural coeffect language \scl}
\label{fig:scl-types}

\end{figure}
%</scl-types>

% ==================================================================================================
% COEFFECT META-LANGUAGE
% ==================================================================================================

%<*cml-types>
\begin{figure}
\begin{equation*}
\rulefcl{var}
  {x : \alpha \in \Gamma}
  {\Gamma \vdash x : \alpha }
\end{equation*}
\begin{equation*}
\rulefcl{app}
  {\Gamma \vdash e_1 : \alpha \rightarrow \beta &
   \Gamma \vdash e_2 : \alpha }
  {\Gamma \vdash e_1~e_2 : \beta}
\end{equation*}
\begin{equation*}
\rulefcl{abs}
  {\Gamma, x:\alpha \vdash e : \beta}
  {\Gamma \vdash \lambda x.e : \alpha \rightarrow \beta }
\end{equation*}
\begin{equation*}
\rulescl{letbox}
  {\Gamma \vdash e_1 : \ctyp{r \mseq s}{\alpha} & \Gamma, x : \ctyp{r}{\alpha} \vdash e_2 : \beta }
  {\Gamma \vdash \kvd{let~box}~x=e_1~\kvd{in}~e_2 : \ctyp{s}{\beta}}
\end{equation*}
\begin{equation*}
\rulescl{eval}
  {\Gamma \vdash e : \ctyp{\munit}{\alpha}}
  {\Gamma \vdash !e : \alpha}
\end{equation*}
\begin{equation*}
\rulefcl{sub}
  {\Gamma \vdash e : \ctyp{s}{\alpha} }
  {\Gamma \vdash e : \ctyp{r}{\alpha} }
\;(s\leq r)  
\end{equation*}

\caption{Type system for the coeffect meta-language \cml}
\label{fig:cml-types}
\end{figure}
%</cml-types>

\end{document}
